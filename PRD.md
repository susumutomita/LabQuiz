# PRD: https://github.com/o-shina/scrum-guardこれと同じ仕組みで細胞培養の基本やラボルール会社の仕組みを楽しく覚えてテストできる仕組みを作りたい

## 問題定義
バイオ系ラボにおいて、新人スタッフ（月1人以上入社）への教育がOJT中心で1人あたり1ヶ月以上かかり、口頭伝達による抜け漏れ・属人化が常態化している。特にゾーニング（汚染エリア区分）は暗黙知化しており体系的に教えられない。結果としてコンタミが数ヶ月に1回発生し、先輩社員の教育工数が継続的に浪費されている。scrum-guard のようなクイズ形式の反復学習システムで、細胞培養手順・ラボルール・安全管理を構造化し、新人が自律的に学習・テストできる仕組みを構築する。

## 対象ユーザー
バイオ系中規模ラボ（10〜30人）の新人スタッフ（入社直後〜3ヶ月目）、教育担当の先輩研究員、クイズ内容をレビューする専門家（研究責任者等）、学習進捗を把握するラボマネージャー

## Jobs to be Done
1. 新人として：細胞培養手順・ゾーニング・試薬安全管理・報告ルートを、反復クイズで自分のペースで確実に覚えたい
2. 先輩研究員として：同じ説明を何度も繰り返さず、新人の理解度を客観的に把握して不足箇所だけ補足したい
3. 専門家として：クイズ内容を10分以内で効率的にレビューし、誤情報の配信を防ぎたい
4. ラボマネージャーとして：新人ごとの学習進捗とテスト結果を一覧で確認し、OJT期間を短縮したい

## コア機能（MVP）
### カテゴリ別クイズ出題・回答エンジン
「細胞培養基本」「ゾーニング」「試薬安全管理」「ラボルール」「報告ルート」等のカテゴリから4択クイズを出題。正誤判定・解説表示・スコア計算をリアルタイムで実施。満点を目指す反復動機づけとしてスコアとバッジを付与する。

**優先度**: must

**受け入れ基準**:
- DBに登録されたクイズ問題がカテゴリ別にランダム抽出され、ブラウザに表示される
- 回答送信後、正誤判定と解説がDBから取得・表示される
- 1セッションのスコア（正答数/出題数）がDBに保存される
- 満点達成時にバッジがユーザーレコードに付与される
- データ経路はすべて実DBを使用し、モックデータやハードコード配列は不可

**エッジケース**:
- カテゴリ内に問題が0件の場合：「このカテゴリにはまだ問題がありません」と表示
- 回答送信中にネットワーク断：回答をローカルに保持し、復帰後に再送信を試行
- 同時に同じクイズセッションを複数タブで開いた場合：最後の送信のみを有効とする
- 不正な回答値（選択肢IDが存在しない等）：サーバー側で検証しエラー返却

### クイズ問題管理・AI生成＋専門家レビュー
既存マニュアル（PDF/テキスト）をアップロードすると、AIが4択クイズ候補を生成。専門家が差分レビュー画面で承認/修正/却下を行う。承認済み問題のみが出題対象になる。

**優先度**: must

**受け入れ基準**:
- マニュアルファイル（PDF/TXT）アップロード後、AI APIを呼び出しクイズ候補がDBに保存される
- レビュー画面で問題文・選択肢・正答・解説が一覧表示され、承認/修正/却下操作ができる
- 承認ステータスが「承認済」の問題のみが出題エンジンから取得される
- 10問のレビューが10分以内で完了できるUI（1問あたり60秒以内で判断可能な情報量）
- データ経路は実DB・実AI API接続であること

**エッジケース**:
- AI APIがタイムアウトした場合：エラーメッセージ表示＋リトライボタン
- アップロードファイルが空・不正形式の場合：バリデーションエラーを即時表示
- AI生成結果が0件の場合：「問題を生成できませんでした。マニュアル内容を確認してください」と表示
- 複数の専門家が同じ問題を同時にレビューした場合：楽観的ロックで後の更新時に競合通知
- 却下された問題の再生成要求フロー

### ゾーニング視覚化クイズ
ラボの平面図画像上にエリアをマッピングし、「このエリアで安全キャビネットは必要か？」等のゾーニング判断をクイズ化。暗黙知を視覚的に構造化して出題する。

**優先度**: must

**受け入れ基準**:
- 管理者がラボ平面図画像をアップロードし、クリックでエリアを矩形指定・ゾーン属性（清潔/準清潔/一般）を付与できる
- 出題時にエリアがハイライトされ、そのエリアのルールに関する問題が表示される
- ゾーンデータ・エリア座標・属性はすべてDBに保存される
- データ経路が実DBであること

**エッジケース**:
- 平面図がアップロードされていない状態でゾーニングクイズを選択：「平面図が未登録です」と表示
- エリア定義が0件の場合：出題不可のメッセージ表示
- 画像ファイルが大きすぎる場合（10MB超）：サイズ制限エラー
- モバイル端末でのエリア指定操作の精度低下：最小エリアサイズを設定

### 学習進捗ダッシュボード
新人ごとのカテゴリ別正答率・受験回数・満点達成状況・弱点カテゴリを一覧表示。ラボマネージャーがOJT補足箇所を特定できる。

**優先度**: must

**受け入れ基準**:
- ユーザー一覧にカテゴリ別正答率・受験回数・最終受験日が表示される
- 正答率が70%未満のカテゴリが「要注意」としてハイライトされる
- データはDBのクイズ回答履歴から集計される（リアルタイム）
- CSV形式でのエクスポートが可能
- データ経路が実DBであること

**エッジケース**:
- 受験履歴が0件のユーザー：「未受験」と表示
- 大量ユーザー（30人）の一覧表示時のページネーション
- 権限のないユーザーがダッシュボードにアクセス：403エラー表示

### ユーザー・ロール管理
新人（学習者）、先輩研究員（問題作成者）、専門家（レビュアー）、ラボマネージャー（管理者）のロールを管理。ロールに応じた画面・機能アクセス制御。

**優先度**: must

**受け入れ基準**:
- 管理者がユーザーを登録し、4種のロール（learner/creator/reviewer/admin）を付与できる
- ロールに応じてアクセス可能な画面・APIが制限される
- 認証はメールアドレス＋パスワードで実施、セッション管理はサーバーサイド
- ユーザーデータは実DBに保存されること

**エッジケース**:
- 管理者が自分自身のロールを削除しようとした場合：操作を禁止
- 存在しないメールアドレスでログイン試行：「メールアドレスまたはパスワードが違います」と表示（情報漏洩防止）
- 同一メールアドレスでの重複登録：一意制約エラー表示
- パスワードが8文字未満の場合：バリデーションエラー

## Non-Goals（やらないこと）
- 複数ラボ間の統合管理・マルチテナント対応（現時点では単一ラボ対象）
- OJT自体の廃止（対面教育の補完であり代替ではない）
- 動画教材の作成・配信機能
- スマートフォンネイティブアプリの開発（Webブラウザ対応のみ）
- 教育コストの自動金額換算・ROI算出ダッシュボード

## ユーザーフロー
### 新人のクイズ学習フロー
1. ログイン
2. カテゴリ一覧から学習したいカテゴリを選択
3. クイズ開始（10問1セット）
4. 各問題に回答し、即時に正誤・解説を確認
5. セッション終了後にスコアとバッジを確認
6. 弱点カテゴリを再受験

### AI問題生成＋専門家レビューフロー
1. 先輩研究員がマニュアルPDFをアップロード
2. カテゴリとAI生成問題数を指定して生成実行
3. AI生成されたクイズ候補一覧が表示される
4. 専門家がレビュー画面で各問題を承認/修正/却下
5. 承認された問題が出題プールに追加される

### ラボマネージャーの進捗確認フロー
1. ログイン
2. ダッシュボードでユーザー一覧と進捗を確認
3. 要注意カテゴリのある新人を特定
4. 該当新人の詳細画面で回答履歴を確認
5. 必要に応じてOJT補足指示を行う

## 非機能要件（ISO/IEC 25010）
### 機能適合性
クイズ出題・回答・スコア計算・レビューワークフローが仕様通りに動作する
- 全カテゴリのクイズ出題→回答→スコア保存→解説表示のパスが正常完了する
- 承認済み問題のみが出題され、未承認・却下問題は出題されない
- 正答率計算が回答履歴と一致する（誤差0%）

### 性能効率性
30人規模のラボで快適に動作する性能
- クイズ出題APIの応答は95パーセンタイルで1秒以内
- ダッシュボードの集計表示は30ユーザー分で3秒以内
- AI問題生成は10問あたり60秒以内にレスポンスを返す
- 同時接続10ユーザーで性能劣化なし

### 互換性
ラボ環境で使用される主要ブラウザで動作する
- Chrome/Safari/Firefox/Edgeの最新版で全機能が動作する
- REST APIはJSON形式で外部システムと連携可能
- 画面解像度1280x720以上で表示崩れなし

### 使用性
ITリテラシーが高くないラボスタッフが説明なしで操作できる
- 初回ユーザーがログインからクイズ完了まで説明なしで5分以内に完了できる
- レビュー画面で1問の承認/却下操作が3クリック以内で完了する
- エラー発生時にユーザーが次のアクションを理解できるメッセージを表示する
- 色覚多様性に配慮し、正誤表示を色だけでなくアイコン・テキストでも区別する

### 信頼性
業務時間中に安定して利用可能
- 月間稼働率99.5%以上
- DB障害時にクイズ回答データが消失しない（トランザクション管理）
- AI API障害時でもクイズ出題機能（既存問題）は継続動作する

### セキュリティ
ラボの業務情報・マニュアル内容を保護する
- 全入力値はサーバーサイドでバリデーション実施
- パスワードはbcrypt以上の強度でハッシュ化して保存
- ロールベースアクセス制御により権限外の操作をAPI・UI両方で遮断
- アップロードされたマニュアルファイルは認証済みユーザーのみアクセス可能
- 全操作ログ（ログイン・レビュー承認等）をDB記録し否認防止を担保

### 保守性
小規模チームで継続的に保守・拡張できる
- 主要モジュール（クイズエンジン・レビュー・ダッシュボード）のユニットテストカバレッジ80%以上
- API層とビジネスロジック層が分離されている
- DB スキーマ変更はマイグレーションファイルで管理

### 移植性
別ラボへの展開時に容易にセットアップできる
- Docker Composeで全サービス（アプリ・DB・AIプロキシ）を起動可能
- 環境変数で外部API キー・DB接続先を切り替え可能
- 初期セットアップ手順がREADMEに記載され、30分以内に完了可能

## 計測指標
| 指標 | 定義 | 目標 |
|------|------|------|
| 新人の平均OJT期間 | 入社日からラボマネージャーが「独り立ち」認定した日までの日数の平均 | 導入前比で30%短縮（例：30日→21日） |
| カテゴリ別正答率の推移 | 各新人の初回受験時正答率と3回目受験時正答率の差分 | 3回目受験時に全カテゴリ平均正答率80%以上 |
| 先輩の教育工数 | 先輩研究員が新人教育に費やした時間（自己申告/週次） | 導入前比で50%削減 |
| コンタミ発生頻度 | コンタミネーション報告件数/月 | 導入後6ヶ月で発生間隔が2倍に延伸 |
| クイズ問題レビュー効率 | 専門家が10問のレビューに要する時間 | 10分以内 |

## 実装制約

この PRD を実装する際、以下のルールを必ず遵守すること。

- モックデータ、ハードコードされた配列、スタブ API での実装は完了とみなさない
- すべてのデータは実際の DB/API から取得・保存すること。「見た目が動く」だけでは受け入れ基準を満たさない
- バックエンド API が未実装の場合、UI より先にバックエンドの最小実装（仮でも本物の I/O）を作ること
- 未実装の機能は UI 上で明示的に「未実装」と表示し、モックで補完してはならない
