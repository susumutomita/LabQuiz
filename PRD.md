# PRD: Lab Checkpoint

参考: https://github.com/o-shina/scrum-guard — これと同じ仕組みで細胞培養の基本やラボルール・安全管理を楽しく覚えてテストできる仕組みを作る。

## 問題定義

バイオ系ラボにおいて、新人スタッフへの教育が OJT 中心で属人化している。特にゾーニング（汚染エリア区分）は暗黙知化しており体系的に教えられない。結果としてコンタミが発生し、先輩社員の教育工数が浪費されている。ゲーム形式の反復学習で、細胞培養手順・ラボルール・安全管理を構造化し、新人が自律的に学習できる仕組みを構築する。

## 対象ユーザー

バイオ系中規模ラボ（10〜30 人）の新人スタッフ（入社直後〜3 ヶ月目）

## ゲームコンセプト: ラボ検問

プレイヤーは **安全監査官** となり、ラボの検問所で作業者の手順をチェックする。各作業者はキャラクター（名前・役職・アバター）として登場し、作業報告書と発言を提示する。プレイヤーは参照用ラボマニュアルを確認しながら **通過許可** または **違反指摘** を判定する。

### ゲームルール

- 全カテゴリからランダム 10 問がデフォルト
- カテゴリ別訓練モードもあり
- 3 回誤判定でゲームオーバー（QUARANTINE）
- ランク制: S(全問正解) / A(80%+) / B(60%+) / F

### カテゴリ

1. 細胞培養基本 — クリーンベンチ操作、継代培養、コンタミ防止
2. ゾーニング — クリーンルーム入退室、エリア区分、物品管理
3. 試薬安全管理 — 保管方法、保護具、廃液処理
4. ラボルール — 実験記録、退室手順、飲食禁止
5. 報告ルート — インシデント対応、報告手順

## コア機能

### シナリオ検問エンジン

シナリオデータ（キャラクター・状況・発言・参照ルール・違反有無）に基づき、プレイヤーが通過/違反を判定。即時正誤判定・解説をモーダル表示。スコア計算・満点バッジ付与。

**受け入れ基準**:
- Spreadsheet に登録された approved シナリオがランダム抽出される
- categoryId 省略時は全カテゴリから混合出題
- 判定送信後、正誤判定と解説がモーダルで表示される
- 3 ミスでゲームオーバー画面に遷移
- セッション終了時にスコア・ランクが表示される
- 満点時にバッジが付与される

### ランク表示

| ランク | 条件 | 演出 |
|--------|------|------|
| S | 100% | 🧬 金色グロー + 「細胞が見えてきましたね」 |
| A | 80%+ | ✅ 緑 + 「優秀な監査官です」 |
| B | 60%+ | ⚠️ 黄 + 「もう少し注意が必要です」 |
| F | 60%未満 | ☣️ ピンク + 「再訓練が必要です」 |

## Non-Goals

- 複数ラボ間のマルチテナント対応
- AI による問題自動生成（将来検討）
- スマートフォンネイティブアプリ
- 管理者ダッシュボード（シンプルに保つ）
- ユーザー認証 UI（Google Workspace SSO で自動）

## 実装アーキテクチャ

- **GAS Web App**: React SPA を HtmlService で配信、バックエンドロジックも GAS
- **データ**: Google Spreadsheet（6 シート）
- **認証**: Google Workspace SSO（`Session.getActiveUser()`）
- **ビルド**: esbuild (GAS) + Vite + vite-plugin-singlefile (フロント)
- **デプロイ**: clasp push

## シナリオデータ構造

| フィールド | 説明 |
|------------|------|
| id | シナリオ ID |
| category_id | カテゴリ ID |
| char_name | キャラクター名 |
| char_role | 役職 |
| char_avatar | 絵文字アバター |
| situation | 作業状況（キー: 値 形式） |
| dialogue | 作業者の発言 |
| reference | 参照用ラボマニュアル |
| is_violation | 違反かどうか (TRUE/FALSE) |
| explanation | 解説 |
| status | approved / pending / rejected |
